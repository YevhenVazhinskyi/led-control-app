# Project Diary - LED Control App

## Обзор
**Проект**: LED Control App  
**Начало ведения**: 2024-12-19  
**Цель**: Отслеживание технических решений, проблем и их решений для обеспечения бесшовной работы команды  
**Область ответственности**: Только Flutter приложение (STM32WB55 - отдельный проект)

---

## [2024-12-19] - Инициализация проекта

### Наблюдения
- Проект создан с базовой структурой Flutter
- Текущая версия Flutter: 3.7.2+
- Проект содержит только базовые файлы (main.dart, start_screen.dart)
- Настроен анализ кода с flutter_lints
- Есть базовый UI с градиентным фоном и кнопкой "Start Quiz"

### Решения
- Создана папка `docs/` для документации проекта
- Разработана детальная архитектура в `Project.md`
- Создан `Tasktracker.md` для отслеживания прогресса
- Определена структура проекта с разделением на слои (UI, Business Logic, Services)
- Выбрана технология BLE для связи с STM32WB55 (отдельный проект)
- Определен протокол связи с JSON форматом команд (требует согласования с STM32 командой)

### Проблемы
- Текущий UI не соответствует требованиям проекта (quiz вместо LED control)
- Отсутствует BLE функциональность
- Нет структуры папок согласно архитектуре
- Отсутствуют модели данных и сервисы
- Необходима координация с STM32 командой для согласования протокола

### Технические детали
- **BLE Service UUID**: 0000FFE0-0000-1000-8000-00805F9B34FB
- **LED Control Characteristic**: 0000FFE1-0000-1000-8000-00805F9B34FB
- **LED Status Characteristic**: 0000FFE2-0000-1000-8000-00805F9B34FB
- **Connection Status Characteristic**: 0000FFE3-0000-1000-8000-00805F9B34FB

### Следующие шаги
1. Создать структуру папок lib/
2. Разработать модели данных для LED и BLE
3. Создать базовые сервисы
4. Исследовать BLE библиотеки для Flutter
5. Согласовать протокол связи с STM32 командой

---

## Архитектурные решения

### State Management
**Решение**: Provider/Riverpod  
**Причина**: Простота использования, хорошая производительность, поддержка реактивности  
**Альтернативы**: Bloc, GetX, MobX  
**Статус**: Требует подтверждения

### BLE Library
**Решение**: flutter_blue_plus  
**Причина**: Активная разработка, хорошая документация, поддержка последних версий Flutter  
**Альтернативы**: flutter_ble_peripheral, flutter_blue  
**Статус**: Требует исследования

### Navigation
**Решение**: GoRouter  
**Причина**: Современный подход, поддержка deep links, декларативная навигация  
**Альтернативы**: Navigation 2.0, auto_route  
**Статус**: Требует подтверждения

### Testing Strategy
**Решение**: 
- Unit tests: mockito для мокирования
- Widget tests: flutter_test
- Integration tests: custom BLE mock
**Причина**: Полное покрытие тестирования, изоляция тестов  
**Статус**: Утверждено

---

## Проблемы и их решения

### Проблема 1: Выбор BLE библиотеки
**Описание**: Необходимо выбрать оптимальную BLE библиотеку для Flutter  
**Статус**: В процессе исследования  
**Возможные решения**:
1. flutter_blue_plus - активно развивается, хорошая документация
2. flutter_ble_peripheral - специализированная для периферийных устройств
3. flutter_blue - устаревшая, но стабильная

### Проблема 2: Протокол связи с STM32WB55
**Описание**: Необходимо согласовать формат команд и ответов с STM32 командой  
**Статус**: Требует согласования  
**Решение**: JSON формат с четкой структурой команд и ответов (предлагаемый)

### Проблема 3: Обработка ошибок BLE
**Описание**: Необходимо обрабатывать различные ошибки BLE соединения  
**Статус**: Планируется  
**Планируемое решение**: Retry механизм, fallback режимы, пользовательские уведомления

---

## Технические заметки

### BLE особенности
- STM32WB55 поддерживает BLE 5.0
- Необходимо учитывать ограничения BLE пакетов (20 байт для данных)
- Важно обрабатывать разрыв соединения
- Нужно реализовать переподключение

### Flutter особенности
- Необходимо запрашивать разрешения для BLE на Android/iOS
- Важно обрабатывать lifecycle приложения
- Нужно учитывать background/foreground режимы

### STM32WB55 особенности
- Поддерживает до 8 одновременных BLE соединений
- Имеет встроенный BLE stack
- Поддерживает OTA обновления
- GPIO пины для LED должны быть настроены как выходы

---

## Метрики и KPI

### Производительность
- **Целевое время отклика UI**: < 100ms
- **Целевое время BLE команды**: < 500ms
- **Целевое время подключения**: < 3 секунды
- **Целевое покрытие тестами**: > 80%

### Качество кода
- **Целевое количество ошибок линтера**: 0
- **Целевое покрытие документацией**: 100% публичных API
- **Целевое время сборки**: < 2 минуты

### Пользовательский опыт
- **Целевое время обучения**: < 5 минут
- **Целевая частота ошибок**: < 1%
- **Целевая оценка пользователей**: > 4.5/5

---

## Заметки для команды

### Важные даты
- **2024-12-19**: Начало проекта
- **2024-12-26**: Планируемое завершение Этапа 1
- **2025-01-02**: Планируемое завершение Этапа 2
- **2025-01-09**: Планируемое завершение Этапа 3

### Критические решения
1. Выбор BLE библиотеки (влияет на всю архитектуру)
2. Согласование протокола связи с STM32 командой (влияет на совместимость)
3. Выбор state management (влияет на производительность)

### Риски
1. **Высокий**: Сложность BLE интеграции
2. **Средний**: Совместимость с различными устройствами
3. **Низкий**: Производительность на слабых устройствах

---

## Контакты и ресурсы

### Документация
- [Flutter BLE Guide](https://flutter.dev/docs/development/data-and-backend/state-mgmt/simple)
- [STM32WB55 Reference Manual](https://www.st.com/resource/en/reference_manual/dm00513983-stm32wb55rg-stm32wb55vg-stm32wb55cg-stm32wb55qg-stm32wb55vg-stm32wb55zg-stm32wb55og-stm32wb55pg-advanced-armbased-32bit-mcus-stmicroelectronics.pdf)
- [BLE Specification](https://www.bluetooth.com/specifications/bluetooth-core-specification/)

### Инструменты
- **IDE**: VS Code / Android Studio
- **BLE Debug**: nRF Connect
- **Testing**: Flutter Test, Mockito
- **Version Control**: Git

---

*Дневник обновляется после каждого значительного изменения в проекте* 