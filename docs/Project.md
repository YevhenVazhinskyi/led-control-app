# LED Control App - Project Documentation

## Обзор проекта

**Название**: LED Control App  
**Версия**: 1.0.0  
**Описание**: Мобильное приложение на Flutter для управления 4 светодиодами через микроконтроллер STM32WB55 (отдельный проект)  
**Дата создания**: 2024-12-19  
**Область ответственности**: Только Flutter приложение  

## Цели проекта

### Основные цели
- Создать интуитивно понятное мобильное приложение для управления LED
- Обеспечить надежную связь с микроконтроллером STM32WB55
- Реализовать возможность индивидуального управления каждым из 4 светодиодов
- Обеспечить безопасность и стабильность работы

### Технические требования
- Поддержка Bluetooth Low Energy (BLE) для связи с STM32WB55
- Кроссплатформенность (iOS/Android)
- Реактивный UI с мгновенным откликом
- Обработка ошибок соединения
- Сохранение состояния LED

## Архитектура системы

### Общая архитектура
```
┌─────────────────┐    BLE    ┌─────────────────┐    GPIO    ┌─────────────┐
│   Flutter App   │ ◄────────► │   STM32WB55     │ ◄────────► │ LED1-LED4   │
│   (Mobile)      │            │   (Controller)  │            │             │
└─────────────────┘            └─────────────────┘            └─────────────┘
```

### Компоненты системы

#### 1. Flutter Application
- **UI Layer**: Material Design интерфейс
- **Business Logic**: Управление состоянием LED
- **BLE Service**: Коммуникация с микроконтроллером
- **State Management**: Provider/Riverpod для управления состоянием

#### 2. STM32WB55 Microcontroller (Отдельный проект)
- **BLE Stack**: STM32WB BLE middleware
- **GPIO Control**: Управление 4 GPIO пинами
- **Protocol Handler**: Обработка команд от приложения
- **Примечание**: Разрабатывается в отдельном проекте

#### 3. LED Hardware (Отдельный проект)
- 4 светодиода подключенных к GPIO пинам
- Защитные резисторы
- Возможность PWM для регулировки яркости
- **Примечание**: Входит в область ответственности STM32 проекта

## Технологический стек

### Frontend (Flutter)
- **Framework**: Flutter 3.7.2+
- **Language**: Dart
- **State Management**: Provider/Riverpod
- **BLE**: flutter_blue_plus
- **UI**: Material Design 3
- **Testing**: flutter_test, mockito

### Backend (STM32WB55) - Отдельный проект
- **MCU**: STM32WB55RG
- **IDE**: STM32CubeIDE
- **BLE Stack**: STM32WB BLE middleware
- **Protocol**: Custom BLE service
- **Примечание**: Разрабатывается отдельно, не входит в область ответственности данного проекта

### Development Tools
- **Version Control**: Git
- **Code Quality**: flutter_lints
- **Documentation**: Markdown
- **Build System**: Flutter CLI

## Протокол связи

### BLE Service Structure
```
Service UUID: 0000FFE0-0000-1000-8000-00805F9B34FB
├── Characteristic: LED Control (Write)
│   └── UUID: 0000FFE1-0000-1000-8000-00805F9B34FB
├── Characteristic: LED Status (Read/Notify)
│   └── UUID: 0000FFE2-0000-1000-8000-00805F9B34FB
└── Characteristic: Connection Status (Notify)
    └── UUID: 0000FFE3-0000-1000-8000-00805F9B34FB
```

### Команды управления
```json
{
  "command": "led_control",
  "led_id": 1-4,
  "action": "on|off|toggle",
  "brightness": 0-255
}
```

### Ответы от устройства
```json
{
  "status": "success|error",
  "led_id": 1-4,
  "state": "on|off",
  "brightness": 0-255,
  "error_code": "optional"
}
```

## Структура проекта

```
lib/
├── main.dart                 # Точка входа приложения
├── screens/
│   ├── home_screen.dart      # Главный экран управления LED
│   ├── bluetooth_scan_screen.dart # Экран сканирования BLE устройств
│   ├── settings_screen.dart  # Настройки приложения
│   └── connection_screen.dart # Экран подключения
├── services/
│   ├── ble_service.dart      # BLE коммуникация
│   ├── led_service.dart      # Бизнес-логика LED
│   └── storage_service.dart  # Локальное хранение
├── models/
│   ├── led_state.dart        # Модель состояния LED
│   └── ble_device.dart       # Модель BLE устройства
├── widgets/
│   ├── led_control_widget.dart # Виджет управления LED
│   ├── connection_widget.dart  # Виджет статуса соединения
│   └── custom_buttons.dart     # Кастомные кнопки
└── utils/
    ├── constants.dart        # Константы приложения
    └── helpers.dart          # Вспомогательные функции
```

## Этапы разработки

### Этап 1: Базовая структура (Неделя 1)
- [x] Создание Flutter проекта
- [x] Настройка архитектуры проекта
- [x] Создание базовых экранов
- [x] Настройка навигации
- [x] Создание системы сканирования BLE устройств

### Этап 2: BLE интеграция (Неделя 2)
- [ ] Исследование BLE библиотек
- [ ] Создание BLE сервиса
- [ ] Реализация подключения к STM32WB55 (согласование протокола)
- [ ] Тестирование соединения (с mock устройством)

### Этап 3: LED управление (Неделя 3)
- [ ] Согласование протокола связи с STM32 командой
- [ ] Реализация команд управления LED
- [ ] Создание UI для управления
- [ ] Интеграция с BLE сервисом

### Этап 4: UI/UX (Неделя 4)
- [ ] Дизайн интерфейса
- [ ] Анимации и переходы
- [ ] Обработка ошибок
- [ ] Тестирование пользовательского опыта

### Этап 5: Тестирование и оптимизация (Неделя 5)
- [ ] Unit тесты
- [ ] Widget тесты
- [ ] Интеграционные тесты (с mock STM32WB55)
- [ ] Оптимизация производительности

### Этап 6: Развертывание (Неделя 6)
- [ ] Подготовка к релизу
- [ ] Создание APK/IPA
- [ ] Документация пользователя
- [ ] Финальное тестирование (с реальным STM32WB55)

## Стандарты разработки

### Код стиль
- Следование Dart/Flutter conventions
- Использование flutter_lints
- Комментарии на английском языке
- Документирование публичных API

### Git workflow
- Feature branches для новых функций
- Conventional commits
- Code review перед merge
- Semantic versioning

### Тестирование
- Минимум 80% покрытие кода
- Unit тесты для бизнес-логики
- Widget тесты для UI компонентов
- Интеграционные тесты для BLE

## Безопасность

### BLE безопасность
- Проверка MAC адреса устройства
- Валидация входящих данных
- Обработка разрыва соединения
- Защита от replay атак

### Данные приложения
- Шифрование локального хранилища
- Безопасное хранение настроек
- Логирование ошибок без PII

## Производительность

### Оптимизации
- Lazy loading для экранов
- Кэширование BLE соединения
- Оптимизация перерисовки UI
- Минимизация BLE трафика

### Мониторинг
- Метрики производительности
- Логирование ошибок
- Аналитика использования

## Поддержка и сопровождение

### Версионирование
- Semantic versioning (MAJOR.MINOR.PATCH)
- Changelog для каждой версии
- Миграция данных между версиями

### Обновления
- Автоматические проверки обновлений
- Согласование обновлений с STM32 командой
- Rollback механизм

## Риски и митигация

### Технические риски
1. **BLE нестабильность**
   - Митигация: Retry механизм, fallback режимы
2. **Совместимость устройств**
   - Митигация: Тестирование на различных устройствах
3. **Производительность**
   - Митигация: Профилирование и оптимизация
4. **Координация с STM32 командой**
   - Митигация: Четкое согласование протокола, mock тестирование

### Бизнес риски
1. **Изменение требований**
   - Митигация: Гибкая архитектура, модульность
2. **Задержки разработки**
   - Митигация: Agile подход, регулярные демо

## Заключение

Данный документ описывает полную архитектуру и план разработки приложения для управления LED через STM32WB55. Проект структурирован для обеспечения качества, безопасности и поддерживаемости кода. Регулярные обновления документации обеспечат актуальность информации для команды разработки. 